<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <div class="d-flex pt-3 pb-2 mb-3 border-bottom">
    <h1 class="display-5 fw-bolder"><%= creations[0].WaifuName %></h1>
  </div>
  <div class="row gx-4 gx-lg-5 align-items-center">
    <div class="col-lg-6 mb-3">
      <img class="img-fluid mb-5 mb-md-0" src="<%= creations[0].imageUrl %>" alt="Creation Image">
    </div>
    <div class="col-md-6">
      <div class="small mb-1">Creation ID: <%= creations[0].id %></div>

      <% if (isAuthenticated && isMyCreation) { %>
        <div class="fs-5 mb-5">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="publicSwitch" <% if (creations[0].public) { %> checked <% } %>>
            <label class="form-check-label" for="publicSwitch">Public</label>
          </div>
        </div>
      <% } else { %>
        <div class="fs-5 mb-5">
          <span class="fs-5 mb-5">Public creation</span>
        </div>
      <% } %>

      <span class="fs-5 mb-5">Prompt:</span>
      <p class="lead"><%= creations[0].prompt %></p>
      <span class="fs-5 mb-5">Negative prompt:</span>
      <p class="lead"><%= creations[0].negative_prompt %></p>
      <span class="fs-5">Model</span>
      <p><%= creations[0].model %></p>
      <span class="fs-5">Scheduler</span>
      <p><%= creations[0].scheduler %></p>
      <span class="fs-5">Steps:</span>
      <p><%= creations[0].steps %></p>
      <span class="fs-5">Guidance:</span>
      <p><%= creations[0].guidance %></p>
      <span class="fs-5">Seed</span>
      <p><%= creations[0].seed %></p>
      <span class="fs-5">Resolution</span>
      <p><%= creations[0].imageWidth %> x <%= creations[0].imageHeight %></p>

      <% if (isAuthenticated && isMyCreation) { %>
        <!-- Delete Button -->
        <button type="button" class="btn btn-danger float-end" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
          <i class="bi bi-trash"></i> Delete
        </button>
      <% } %>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this creation?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form id="deleteForm" action="/creations/<%= creations[0].id %>/delete" method="POST">
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var publicSwitch = document.getElementById('publicSwitch');
    publicSwitch.addEventListener('change', function () {
      var isChecked = this.checked;
      var creationId = `<%= creations[0].id %>`;

      // Make fetch request to backend
      fetch('/updateCreationPublicStatus', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: creationId, isPublic: isChecked })
      })
        .then(response => {
          if (response.ok) {
            console.log('Public status updated successfully');
          } else {
            console.error('Error updating public status:', response.statusText);
          }
        })
        .catch(error => {
          console.error('Error updating public status:', error);
        });
    });
  });
</script>
